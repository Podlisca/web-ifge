<!-- Verstecktes Upgrade-Formular für Formspree -->
<form action="https://formspree.io/f/xqalakkv" method="POST" style="display: none;" id="upgrade-form">
  <input type="hidden" name="Produkt" value="Dynamisch durch JS einsetzen">
  <input type="hidden" name="Anrede" id="form-anrede">
  <input type="hidden" name="Titel" id="form-titel">
  <input type="hidden" name="Vorname" id="form-vorname">
  <input type="hidden" name="Nachname" id="form-nachname">
  <input type="hidden" name="Email" id="form-email">
  <input type="hidden" name="Strasse" id="form-strasse">
  <input type="hidden" name="PLZ" id="form-plz">
  <input type="hidden" name="Ort" id="form-ort">
  <input type="hidden" name="Land" id="form-land">
  <input type="hidden" name="UID" id="form-uid">
  <input type="hidden" name="Mitteilung" id="form-mitteilung">
  <button type="submit">Senden</button>
</form>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const boxes = document.querySelectorAll('.kursbox');
    const upgrade = document.getElementById('upgrade-form');

    if (!upgrade) return;

    boxes.forEach(function (box) {
      const form = box.querySelector('form');
      if (!form) return;

      form.addEventListener('submit', function (event) {
        // Optional: event.preventDefault(); falls du den Stripe-Zahlungsaufruf später manuell triggern möchtest

        const getVal = (selector, allIndex = null) => {
          if (allIndex !== null) {
            return form.querySelectorAll(selector)[allIndex]?.value.trim() || '';
          }
          return form.querySelector(selector)?.value.trim() || '';
        };

        // Daten auslesen
        const produkt = box.querySelector('h2')?.textContent.trim() || 'Unbekanntes Produkt';
        const anrede = getVal('select[required]');
        const titel = getVal('select:not([required])');
        const vorname = getVal('input[type="text"]', 0);
        const nachname = getVal('input[type="text"]', 1);
        const email = getVal('input[type="email"]');
        const strasse = getVal('input[type="text"]', 2);
        const plz = getVal('input[type="text"]', 3);
        const ort = getVal('input[type="text"]', 4);
        const land = getVal('input[type="text"]', 5);
        const uid = getVal('input[type="text"]', 6);
        const mitteilung = form.querySelector('textarea')?.value.trim() || '';

        // Hidden-Formular befüllen
        upgrade.querySelector('#form-anrede').value = anrede;
        upgrade.querySelector('#form-titel').value = titel;
        upgrade.querySelector('#form-vorname').value = vorname;
        upgrade.querySelector('#form-nachname').value = nachname;
        upgrade.querySelector('#form-email').value = email;
        upgrade.querySelector('#form-strasse').value = strasse;
        upgrade.querySelector('#form-plz').value = plz;
        upgrade.querySelector('#form-ort').value = ort;
        upgrade.querySelector('#form-land').value = land;
        upgrade.querySelector('#form-uid').value = uid;
        upgrade.querySelector('#form-mitteilung').value = mitteilung;
        upgrade.querySelector('input[name="Produkt"]').value = produkt;

        // Absenden
        upgrade.submit();
      });
    });
  });
</script>
